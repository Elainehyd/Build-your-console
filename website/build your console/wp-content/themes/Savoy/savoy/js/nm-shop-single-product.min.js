/* NM: Single product script */
(function(c){c.extend(c.nmTheme,{singleProduct_init:function(){var a=this;a.zoomEnabled=!a.isTouch&&c(".woocommerce-product-gallery").hasClass("zoom-enabled");"undefined"!==typeof PhotoSwipe&&wc_single_product_params.photoswipe_enabled&&a.$window.load(function(){a.singleProductPhotoSwipeBind()});a.singleProductVariationsInit();a.quantityInputsBindButtons(c(".summary"));a.singleProductGalleryArrowsInit();a.singleProductGalleryZoomInit();a.singleProductFeaturedVideoInit();var b=c("#nm-comment-form-rating");
b.on("click.nmAddParentClass",".stars a",function(){b.children(".stars").addClass("has-active")});var e=c("#nm-upsells").find(".nm-shop-loop-thumbnail .unveil-image"),f=c("#nm-related").find(".nm-shop-loop-thumbnail .unveil-image"),d=c.merge(e,f);a.$window.load(function(){d.length&&d.unveil(1,function(){c(this).parents("li").first().addClass("image-loaded")})});"0"!=nm_wp_vars.shopRedirectScroll&&(c("#nm-breadcrumb").find("a").bind("click.nmShopRedirect",function(b){b.preventDefault();a.singleProductRedirectWithHash(this)}),
c("#nm-product-meta").find("a").bind("click.nmShopRedirect",function(b){b.preventDefault();a.singleProductRedirectWithHash(this)}))},singleProductRedirectWithHash:function(a){a=c(a).attr("href");window.location.href=a+"#shop"},singleProductVariationsInit:function(){var a=this;a.$variationsForm=c("#nm-variations-form");a.$variationsWrap=a.$variationsForm.children(".variations");a.$variationDetailsWrap=a.$variationsForm.children(".single_variation_wrap").children(".single_variation");a.shopCustomSelect&&
a.$variationsWrap.find("select").selectOrDie(a.shopSelectConfig);a.shopCheckVariationDetails(a.$variationDetailsWrap);a.$variationDetailsWrap.on("show_variation",function(){a.shopCheckVariationDetails(a.$variationDetailsWrap)});a.$variationDetailsWrap.on("hide_variation",function(){a.$variationDetailsWrap.css("display","none")});a.$variationsForm.on("woocommerce_variation_select_change",function(){a.zoomEnabled&&a.singleProductZoomUpdateImage()})},singleProductGalleryArrowsInit:function(){var a=this;
if(1<c(".woocommerce-product-gallery__wrapper").children(".woocommerce-product-gallery__image").length){a.singleProductGalleryArrowsOffset();c(".flex-direction-nav").addClass("show");var b=null;a.$window.resize(function(){b&&clearTimeout(b);b=setTimeout(function(){a.singleProductGalleryArrowsOffset()},250)})}},singleProductGalleryArrowsOffset:function(){var a=c(".woocommerce-product-gallery"),b=a.children(".flex-direction-nav").find("a"),e=Math.ceil(a.outerHeight()),a=Math.ceil(a.children(".woocommerce-product-gallery__wrapper").height()),
f=b.first().outerHeight()/2;b.css("marginTop","-"+(f+(e>a?(e-a)/2:0))+"px")},singleProductGalleryZoomInit:function(){this.zoomEnabled&&this.$window.load(function(){c(".woocommerce-product-gallery__wrapper").children(".woocommerce-product-gallery__image").easyZoom()})},singleProductZoomUpdateImage:function(){var a=c(".woocommerce-product-gallery__wrapper").children(".woocommerce-product-gallery__image").first(),b=a.children("a").attr("href");b&&0<b.length&&a.data("easyZoom").swap(b)},singleProductFeaturedVideoInit:function(){var a=
this;a.hasFeaturedVideo=!1;a.$featuredVideoBtn=c("#nm-featured-video-link");a.$featuredVideoBtn.length&&(a.hasFeaturedVideo=!0,a.$featuredVideoBtn.bind("click",function(b){b.preventDefault();b={mainClass:"nm-featured-video-popup nm-mfp-fade-in",closeMarkup:'<a class="mfp-close nm-font nm-font-close2"></a>',removalDelay:180,type:"iframe",closeOnContentClick:!0,closeBtnInside:!1};"0"==nm_wp_vars.shopYouTubeRelated&&(b.iframe={patterns:{youtube:{src:"//www.youtube.com/embed/%id%?rel=0&autoplay=1"}}});
a.$featuredVideoBtn.magnificPopup(b).magnificPopup("open")}))},singleProductPhotoSwipeBind:function(){var a=this;this.$target=c(".woocommerce-product-gallery");this.$target.prepend('<a href="#" class="woocommerce-product-gallery__trigger">\ud83d\udd0d</a>');this.$target.off("click",".woocommerce-product-gallery__trigger");this.$target.on("click.nmGalleryTrigger",".woocommerce-product-gallery__trigger",function(b){b.preventDefault();a.singleProductPhotoswipeInit(b)});this.$target.off("click",".woocommerce-product-gallery__image a");
this.$target.on("click.nmGalleryTrigger",".woocommerce-product-gallery__image a",function(b){b.preventDefault();a.singleProductPhotoswipeInit(b)})},singleProductPhotoSwipeGetItems:function(){var a=c(".woocommerce-product-gallery__wrapper").children(),b=[];0<a.length&&a.each(function(a,f){var d=c(f).find("img"),e=d.attr("data-large_image"),g=d.attr("data-large_image_width"),h=d.attr("data-large_image_height"),d={src:e,w:g,h:h,title:d.attr("title")};b.push(d)});return b},singleProductPhotoswipeInit:function(a){var b=
c(".pswp")[0],e=this.singleProductPhotoSwipeGetItems();a=c(a.target);a=a.is(".woocommerce-product-gallery__trigger")?this.$target.find(".flex-active-slide"):a.closest(".woocommerce-product-gallery__image");a={index:c(a).index(),history:!1,showHideOpacity:!0,showAnimationDuration:0,bgOpacity:1,loop:!1,closeOnVerticalDrag:!1,barsSize:{top:0,bottom:0},shareE1:!0,tapToClose:!0,tapToToggleControls:!1};b=new PhotoSwipe(b,PhotoSwipeUI_Default,e,a);b.init();var f=a.index;b.listen("beforeChange",function(a){f+=
a;c(".woocommerce-product-gallery").flexslider(f)})}});c.nmThemeExtensions.singleProduct=c.nmTheme.singleProduct_init})(jQuery);